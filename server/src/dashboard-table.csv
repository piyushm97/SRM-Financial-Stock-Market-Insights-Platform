from pathlib import Path
import csv

ROOT = Path("server/src")
OUT = ROOT / "dashboard-table.csv"

files = {
    "equity": ROOT / "equity-curve.log",
    "sharpe": ROOT / "sharpe-ratio.log",
    "max_drawdown": ROOT / "max-drawdown.log",
    "profit_factor": ROOT / "profit-factor.log",
    "win_rate": ROOT / "win-rate.log",
    "trend_state": ROOT / "trend-state.log",
}

def last_line(p: Path):
    if not p.exists():
        return ""
    return p.read_text(encoding="utf-8").strip().splitlines()[-1]

def main():
    rows = []
    for name, path in files.items():
        rows.append({"metric": name, "latest": last_line(path)})

    OUT.parent.mkdir(parents=True, exist_ok=True)
    with OUT.open("w", newline="", encoding="utf-8") as f:
        writer = csv.DictWriter(f, fieldnames=["metric", "latest"])
        writer.writeheader()
        writer.writerows(rows)
    print("Wrote dashboard-table.csv with", len(rows), "rows")

if __name__ == "__main__":
    main()
