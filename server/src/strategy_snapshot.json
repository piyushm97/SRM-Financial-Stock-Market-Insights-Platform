// scripts/build-strategy-snapshot.js
const fs = require("fs");
const path = require("path");

function readLast(p) {
  if (!fs.existsSync(p)) return null;
  const lines = fs.readFileSync(p, "utf8").trim().split("\n");
  return lines[lines.length - 1] || null;
}

const root = path.join(__dirname, "..", "server", "src");

const snapshot = {
  generatedAt: new Date().toISOString(),
  equity: readLast(path.join(root, "equity-curve.log")),
  sharpe: readLast(path.join(root, "sharpe-ratio.log")),
  maxDrawdown: readLast(path.join(root, "max-drawdown.log")),
  profitFactor: readLast(path.join(root, "profit-factor.log")),
  trendState: readLast(path.join(root, "trend-state.log")),
};

const outPath = path.join(root, "strategy_snapshot.json");
fs.writeFileSync(outPath, JSON.stringify(snapshot, null, 2) + "\n", "utf8");
console.log("Updated strategy_snapshot.json");
